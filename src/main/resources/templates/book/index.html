<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout" layout:decorator="layout">
<head>
    <title>책 검색 서비스</title>
</head>
<body>
<h1 layout:fragment="header">책 검색</h1>
<div layout:fragment="content" class="container">
    <div class="panel-body">
        <form class="form-inline">
            <select id="target" name="target" class="span2">
                <option th:each="target : ${targets}" th:value="${target.target}" th:text="${target.displayName}"
                        th:selected="${searchOption.target} == ${target.target}"></option>
            </select>
            <input type='text' id='query' name='query' th:value="${searchOption.query}" class="span4"/>
            <button class='btn' id='searchBtn'>검색</button>
        </form>
        <table class="table table-bordered table-striped">
            <thead>
            <tr>
                <td class="span6">제목</td>
                <td class="span2">저자</td>
                <td class="span3">출판사</td>
                <td class="span2">출판일</td>
                <td class="span1">가격</td>
                <td class="span2"></td>
            </tr>
            </thead>
            <tbody>
                <tr th:if="${books.empty}">
                    <td colspan="6">조회 결과가 없습니다.</td>
                </tr>
                <tr th:each="book : ${books}">
                    <td><a class="bookLink" th:href="${book.isbn}" th:text="${book.title}"></a></td>
                    <td th:text="${book.authors}"></td>
                    <td th:text="${book.publisher}"></td>
                    <td th:text="${#calendars.format(book.datetime, 'YYYY-MM-dd')}"></td>
                    <td th:text="${#numbers.formatInteger(book.price, 3, 'COMMA')}">원</td>
                    <td><a class="btn btn-small" href="#"><i class="icon-bookmark"></i>북마크</a></td>
                </tr>
            </tbody>
        </table>
        <div class="pagination pagination-centered">
            <ul>
                <li th:if="${pagingInfo.prev}"><a th:href="${pagingInfo.startPage} - 1">&laquo;</a></li>
                <li th:classappend="${p.pageNumber} == ${searchOption.page} - 1 ? 'active' : '' " th:each="p:${pagingInfo.pageList}">
                    <a th:href="${p.pageNumber} +1" th:text="${p.pageNumber} + 1"></a></li>
                <li th:if="${pagingInfo.next}"><a th:href="${pagingInfo.endPage} + 1">&raquo;</a></li>
            </ul>
        </div>
    </div>

    <form id='searchForm' th:action="@{/book}" method="get">
        <input type='hidden' name='page' th:value="${searchOption.page}" />
        <input type='hidden' name='size' th:value="${searchOption.size}" />
        <input type='hidden' name='target' th:value="${searchOption.target}"/>
        <input type='hidden' name='query' th:value="${searchOption.query}"/>
    </form>
</div>
</body>
<th:block layout:fragment="script">
    <script th:inline="javascript">
        $(document).ready(function() {
            var searchForm = $("#searchForm");

            $('#searchBtn').click(function () {
                var target = $("#target").find(":selected").val();
                var query = $("#query").val();
                searchForm.find("[name='target']").val(target);
                searchForm.find("[name='query']").val(query);
                searchForm.find("[name='page']").val("1");
                searchForm.submit();
            });

            $(".pagination a").click(function(e) {
                e.preventDefault();
                searchForm.find('[name="page"]').val($(this).attr('href'));
                searchForm.submit();
            });

            $(".bookLink").click(function(e){
                e.preventDefault();
                var isbn = $(this).attr("href");
                searchForm.attr('action','/book/view');
                searchForm.append('<input type="hidden" name="isbn" value="' + isbn +'"/>');
                searchForm.submit();
            });

        });
    </script>
</th:block>

</html>
